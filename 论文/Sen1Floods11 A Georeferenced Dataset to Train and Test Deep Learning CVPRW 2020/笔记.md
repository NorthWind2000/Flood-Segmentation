# Abstract

## Sen1Flood11

用于训练和测试深度学习洪水算法的地理参考数据集。

- 该数据由4831张512x512的洪水事件中的图像组成；
- 我们将利用该数据集对区分稳定水和洪水的FCNN模型进行训练、验证和测试；

## 四种数据子集

① 446张手工标注的洪水的水面；

② 814张Landsat公用稳定水数据标签；

③ 4385张来自哨兵2号拍摄的洪水水面图像；

④ 4385张来自哨兵1号拍摄的洪水水面图像。

对比FCNN模型在上面四种数据子集上分类稳定水、洪水和总体地表水的结果。

将四种数据集上训练的模型和一种常用的雷达后向散射阈值遥感识别地表水的方法进行对比：

**结果显示：**

- 在哨兵2号数据集上进行分类训练的FCNN模型，对洪水和总体地表水的识别表现更好；
- 后向散射阈值仅在识别稳定水时表现更好；

总结：

- 基于雷达数据的洪水检测深度学习模型表现优于基于遥感的过滤算法；
- 使用自动生成的大数量标签数据进行训练的效果优于使用小的手工标记的数据集。

Sen1Floods11训练和评估代码：https://github.com/cloudtostreet/Sen1Floods11

# 一、Introduction

## 1.1 洪水检测方法研究现状

在不同的空间分辨率、时间频率和光学与雷达信号能力下，已经为数十个卫星传感器开发了洪水检测方法。

① **MODIS算法**：基于MODIS（中分辨率成像光谱仪，250m空间分辨率）绘制洪水的典型方法是利用水对`短波红外光谱`（SWIR,1628-1652nm, MODIS Band 6）的吸收能力强于其他物体，或者利用水对`近红外光谱`（NIR,841-875nm, MODIS Band 2）的吸收能力强于`可见光谱`(621-670nm MODIS Band1)。

② Landsat卫星使用波段阈值、归一化差分或更复杂的SWIR（1560-1660nm，陆地卫星8号波段6）和NIR（630-690nm，陆地卫星8号波段4）与其他波段的组合。

> 例如：Pekel等人将SWIR、NIR、NIR+Green+Blue映射到HSV上，以估计自1984年以来每月的全球地表水范围。

③ Sentinel-2绘制地表水地图的算法同样依赖于水在SWIR（1539-1681 nm, Band 11）和NIR（768-796 nm, Band 8）上的吸收率利用类似MODIS的算法进行洪水检测。

**存在的问题**

- 由于水和云层阴影对在SWIR和NIR上的吸收率都很高，因此Landsat和Sentinel-2都存在对水和云层阴影的误判。
- 中等分辨率光学传感器的分辨率高于MODIS（30m for Landset and 10m for Sentinel-2），能够解决洪水识别问题，但是其观察频率更低。

SAR传感器能够穿透云层对洪水进行检测，其分辨水面的方法是：相对于其他物体水具有更低的后向散射值。

④ **Sentinel-1利用SAR传感器对洪水进行绘制**。SAR传感器因其穿透云层的检测能力，在洪水检测中非常重要。相对于其他特征，水的后向散射值通常较低，SAR传感器通过识别水来绘制洪水区。通过对单个图像上的后向散射值、两个图像之间的后向散射值差异或时间序列中的后向散射方差进行过滤来识别水。由于“双反弹”效应，城市地区被淹没的植被和洪水可能会在洪水事件期间增加后向散射。

---

然而，几乎所有这些方法都依赖于单阈值使用来确定洪水和非洪水区域，由于水和非水类别之间的强烈重叠，这导致图像中出现“斑点”。这种“噪声”促使了图像清理技术的产生，如使用邻域聚焦函数的空间滤波、精细Lee滤波区域生长或面向对象分类，但通常会以移除远离主洪水通道的小型或孤立溪流或水体为代价。

**深度学习方法在识别云和云层阴影上的表现远优于物理性的方法。然而，大多数算法应用于城市和植被覆盖，很少用来地表水检测。**

利用CNNs检测洪水的三个例子：

- 在一个高分辨率的UAV（无人机）图像上利用CNNs分割洪水区域；
- 结合Sentinel-1和Sentinel-2的图像，利用CNN分辨被淹没的建筑；
- 在Terra-Sar X训练CNN模型。

## 1.2 洪水数据集现状

**目前，并没有关注洪水的训练数据集。为了检验CNN识别跨越城市、农村和地理环境的洪水事件的潜力，我们制作并公开发布Sen1Floods11数据集，包括洪水和稳定水。**

Sen1Floods11数据集：

- 4370张利用简单遥感分类算法自动标注的的图像，用于弱监督学习的训练数据；
- 446张手工标注的图像，用作高质量的训练、测试和验证数据。

四个研究性问题：

- 我们是否需要手工标注用于洪水检测的CNN模型的训练数据？或者说是否可以使用来自遥感式水检测算法的弱监督训练数据？
- 哪一类图像源和算法为弱监督学习提供了最好的标签？
- 与包含洪水数据的训练集相比，仅在稳定水数据上训练CNN模型，什么因素影响模型性能？
- 在雷达数据上利用CNN分辨洪水和稳定水，是否比传统的遥感式方法更准确？

# 二、Datasets

## 2.1 抽样稳定水数据

JRC地表数据是由Landsat卫星以30m分辨率和每月观察的方式提供。为了准确标记水和非水标签，将“永久性”水识别为在数据集开始（1984年）和结束（2018年）检测到水存在的像素。

- 如果一个像素在数据集的观察开始点和结束点都有水存在，那该像素点就归为稳定水；
- 从未观察到水的像素归为无水；
- 将稳定水作为正样本，而将其他类型的水作为忽略的部分；

JRC中的稳定水的标记错误率低于1%，但是对于其他类型的水（季节性、短暂性或不断变化的水）的准确率很低。

JRC地表数据集往往会低估洪水的预测。

## 2.2 洪水事件数据

第二个数据源是11次洪水事件。这11次洪水事件是从全球洪水事件数据库中筛选的，筛选原则是：洪水事件要被Sentinel-1所拍摄到，且在同一天内拍摄的图像与Sentinel-2保持一致或者sentinel-1两天内图像保持一致。

### 2.2.1 预处理

这一部分解释了Sen1Floods11-master中用到的数据集是怎么从一张卫星拍摄的图像变来的。

1. **利用Google地球引擎过滤每一次事件的图像。**

   ① 将每一次事件中的Sentinel-1和Sentinel-2图像，按照场景交集组合的方式叠加成一个图像。（同一位置叠加？）

   ② Sentinel-1洪水参考图是在VH波段上利用一个动态阈值导出的。

2. **Sentinel-1洪水参考图生成流程：**

   ① 在VH波段的图像上创造一个1Km X1Km的网格，用高方差网格构建直方图。

   ② 在直方图上利用Otsu的阈值化，使淹没和非淹没像素的类间方差最大化。（**Otsu算法是由日本学者OTSU于1979年提出的一种对图像进行二值化的高效算法。**）

   ③ 将此阈值应用于焦均值平滑的VH波段，以减少散斑，从而得到二元洪水图。

3. **Sentinel-2洪水参考图生成流程：**

   ① 计算归一化植被差异指数（NDVI）：

$$
NDVI=\frac{(B8-B4)}{(B8+B4)} , (B=band)
$$



​	② 计算修正归一化水体差异指数（MNDWI）：
$$
MNDWI=\frac{(B12-B3)}{(B12+B3)} , (B=band)
$$
​	③ 利用NDVI和MNDWI，并应用专家定义的阈值0.2和0.3，创建Sentinel-2洪水参考图。

4. **利用小于0.2的蓝色波段反射率阈值来识别云。**

5. **通过潜在的云高度、太阳方位角和太阳天顶角投影的阴影来消除云影。**

### 2.2.2 Chip Creation and Sampling

采集图像子集的目的是为了对受洪水影响的主要地区进行采样。之后将子集进一步划分为512x512像素的非重叠片段，删除那些大部分被云覆盖的片段。

和Sentinel-1相比，Sentinel-2具有较好的小水体制图能力、沙漠地区的健壮性以及多雨季节时的晴天状况下较高的平均精度，因此被用作基水分类。

**Sentinel-2图像处理过程：**

1. 计算每一个Sentinel-2片段（4831张）的水域；
2. 对Sentinel-2图像中选出446张分层的样本进行手工标记，用于验证；
3. 保证446张图像中的75%包含超过0.02平方公里的水域，剩余的25%包含小于等于0.02平方公里的水域；
4. 剩余4385张未手工标注但包含水体的图像，仅用于洪水分类，不进行质量控制。

### 2.2.3 Hand Labeling

我们利用Google Earth Engine的创建一个可视化界面，遥感图像分析员利用Google Earth Engine进行水域标注。

标注方法：

1. 利用Sentinel-1 VH波段和Sentinel-2 的两个假彩色图像，以及Google Earth Engine中的水的位置；
2. 将图像中的云的位置标为-1，水的位置标为1，其他区域标为0。

### 2.2.4 Training，Validation，and Testing Data

来自玻利维亚的所有手工标记的数据用于检测未在洪水数据上训练的模型。

除了对玻利维亚数据进行特殊处理外，手动标记的数据被分成训练、验证和测试数据，随机分成60-20-20个部分，所有非手动标记的Sentinel-1和Sentinel-2数据用于弱监督的训练数据。

# 三、Methods

## 3.1 Models

利用不同的数据集训练FCNN模型，进行下面四种比较：

1. 光学数据和雷达数据的比较；
2. 手工标注数据和弱监督数据的比较；
3. 洪水数据和稳定水数据上训练，与仅在稳定水数据上训练；
4. FCNN的性能与常用的利用后向散射进行阈值过滤法的比较。

## 3.2 Convolutional Neural Networks and Accuracy Assessment

1. 利用带有Resnet50 backbone的FCNN进行预测每个像素的类别。
2. 为了增强数据，我们将图像从512x512图像随机裁剪到256x256，并随机应用水平和垂直翻转。
3. 然后，在手动标记的训练集上进行平均值和标准差的归一化。（[0.6851, 0.5235],[0.0820, 0.1102]）
4. 利用IOU进行评估模型，计算平均IOU。

